## 如何判断两个多边形近视相等

----

### Hausdorff distance
使用 Hausdorff 距离判断两个多边形是否近视相等

wiki: https://en.wikipedia.org/wiki/Hausdorff_distance

### 举例说明
#### `arctern`测试脚本
```python
from pyspark.sql import SparkSession
from arctern_pyspark import register_funcs

if __name__ == "__main__":
    spark = SparkSession \
        .builder \
        .appName("union agg test") \
        .getOrCreate()
    
    spark.conf.set("spark.sql.execution.arrow.pyspark.enabled", "true")
    register_funcs(spark)
    test_df = spark.read.json("/tmp/t.json").cache()
    test_df.createOrReplaceTempView("st_union")
    spark.sql("select ST_Union_Aggr_UDF(geos) from (select ST_PolygonFromEnvelope_UDF(a,c,b,d) as geos from st_union) as foo").show(1,0)

```
`/tmp/t.json`内如如下：
```json
{"a": 10.1, "c": 91.9, "b": 19.7, "d": 98.3}
{"a": 16.1, "c": 93.3, "b": 16.6, "d": 94.0}
{"a": 11.0, "c": 88.3, "b": 18.7, "d": 98.2}
{"a": 13.9, "c": 82.2, "b": 19.1, "d": 83.4}
{"a": 12.0, "c": 81.5, "b": 16.2, "d": 90.6}
{"a": 10.4, "c": 87.5, "b": 11.7, "d": 92.2}
{"a": 15.5, "c": 88.7, "b": 18.6, "d": 98.4}
{"a": 14.8, "c": 83.0, "b": 16.9, "d": 85.6}
{"a": 10.8, "c": 83.9, "b": 16.5, "d": 84.4}
{"a": 12.5, "c": 80.8, "b": 14.8, "d": 97.1}
```
`arctern`输出:
```text
POLYGON ((10.1 91.9,10.1 98.3,15.5 98.3,15.5 98.4,18.6 98.4,18.6 98.3,19.7 98.3,19.7 91.9,18.7 91.9,18.7 88.3,16.2 88.3,16.2 85.6,16.9 85.6,16.9 83.4,19.1 83.4,19.1 82.2,16.2 82.2,16.2 81.5,14.8 81.5,14.8 80.8,12.5 80.8,12.5 81.5,12.0 81.5,12.0 83.9,10.8 83.9,10.8 84.4,12.0 84.4,12.0 88.3,11.7 88.3,11.7 87.5,10.4 87.5,10.4 91.9,10.1 91.9))
```
#### `postgis`测试语句
```sql
create table t1 (a real,c real,b real,d real);
insert into t1 values 
(10.1,91.9,19.7,98.3),
(16.1,93.3,16.6,94.0),
(11.0,88.3,18.7,98.2),
(13.9,82.2,19.1,83.4),
(12.0,81.5,16.2,90.6),
(10.4,87.5,11.7,92.2),
(15.5,88.7,18.6,98.4),
(14.8,83.0,16.9,85.6),
(10.8,83.9,16.5,84.4),
(12.5,80.8,14.8,97.1)
;
select st_astext(st_union(geo)) from (select st_makeEnvelope(a,c,b,d) as geo from t1) as foo;
```
`postgis`输出:
```text
 POLYGON((16.8999996185303 83.4000015258789,19.1000003814697 83.4000015258789,19.1000003814697 82.1999969482422,16.2000007629395 82.1999969482422,16.2000007629395 81.5,14.8000001907349 81.5,14.8000001907349 80.8000030517578,12.5 80.8000030517578,12.5 81.5,12 81.5,12 83.9000015258789,10.8000001907349 83.9000015258789,10.8000001907349 84.4000015258789,12 84.4000015258789,12 88.3000030517578,11.6999998092651 88.3000030517578,11.6999998092651 87.5,10.3999996185303 87.5,10.3999996185303 91.9000015258789,10.1000003814697 91.9000015258789,10.1000003814697 98.3000030517578,15.5 98.3000030517578,15.5 98.4000015258789,18.6000003814697 98.4000015258789,18.6000003814697 98.3000030517578,19.7000007629395 98.3000030517578,19.7000007629395 91.9000015258789,18.7000007629395 91.9000015258789,18.7000007629395 88.3000030517578,16.2000007629395 88.3000030517578,16.2000007629395 85.5999984741211,16.8999996185303 85.5999984741211,16.8999996185303 83.4000015258789))
```

#### 使用`Hausdorff distance`判断`arctern`和`postgis`是否近视相等
我们假设两个几何体的`Hausdorff`距离小于几何体最大长度的万分之一，则两个几何体近期相等

```python
import pygeos
p1=pygeos.Geometry("POLYGON ((10.1 91.9,10.1 98.3,15.5 98.3,15.5 98.4,18.6 98.4,18.6 98.3,19.7 98.3,19.7 91.9,18.7 91.9,18.7 88.3,16.2 88.3,16.2 85.6,16.9 85.6,16.9 83.4,19.1 83.4,19.1 82.2,16.2 82.2,16.2 81.5,14.8 81.5,14.8 80.8,12.5 80.8,12.5 81.5,12.0 81.5,12.0 83.9,10.8 83.9,10.8 84.4,12.0 84.4,12.0 88.3,11.7 88.3,11.7 87.5,10.4 87.5,10.4 91.9,10.1 91.9))")

p2=pygeos.Geometry(" POLYGON((16.8999996185303 83.4000015258789,19.1000003814697 83.4000015258789,19.1000003814697 82.1999969482422,16.2000007629395 82.1999969482422,16.2000007629395 81.5,14.8000001907349 81.5,14.8000001907349 80.8000030517578,12.5 80.8000030517578,12.5 81.5,12 81.5,12 83.9000015258789,10.8000001907349 83.9000015258789,10.8000001907349 84.4000015258789,12 84.4000015258789,12 88.3000030517578,11.6999998092651 88.3000030517578,11.6999998092651 87.5,10.3999996185303 87.5,10.3999996185303 91.9000015258789,10.1000003814697 91.9000015258789,10.1000003814697 98.3000030517578,15.5 98.3000030517578,15.5 98.4000015258789,18.6000003814697 98.4000015258789,18.6000003814697 98.3000030517578,19.7000007629395 98.3000030517578,19.7000007629395 91.9000015258789,18.7000007629395 91.9000015258789,18.7000007629395 88.3000030517578,16.2000007629395 88.3000030517578,16.2000007629395 85.5999984741211,16.8999996185303 85.5999984741211,16.8999996185303 83.4000015258789))")

dist = pygeos.measurement.hausdorff_distance(p1,p2)
length1 = pygeos.measurement.length(p1)
length2 = pygeos.measurement.length(p2)
max_len = max(length1,length2)
if dist <  max_len * 0.0001:
    print("Yes")
else:
    print("No")
```

### conda安装pygeos
```bash
conda install -c conda-forge pygeos
```

### 参考链接
- [postgis-hausdorff-distance](http://postgis.net/docs/ST_HausdorffDistance.html)
- [pygeos-hausdorff-distance](https://pygeos.readthedocs.io/en/latest/measurement.html)
- [stack-over-flow](https://gis.stackexchange.com/questions/144714/determining-if-two-geometric-figures-are-approximately-equal-using-postgis)

